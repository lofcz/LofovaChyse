@using DataAccess.Models
@using LofovaChyse.Class
@model DataAccess.Models.KnihovnaUser
@{
    ViewBag.Title = "Index";
    ViewBag.Oceneni = General.GetUserOceneni(Model.Login);
}

<script src="https://unpkg.com/tippy.js@2.0.9/dist/tippy.all.min.js"></script>

<div id="ajaxContent">
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body" id="modalContent">

                </div>
            </div>
        </div>
    </div>

    <h2>Profil uživatele @Model.Name</h2>
    <sub><a href="#">Poslat zprávu</a> | <a href="#">Další kontakty</a></sub> <sub style="float:right"><strong>Profil</strong> | @Html.ActionLink("Zeď", "ViewWall", new { id = Model.Id }) | Galerie | Snippety</sub>
    <br />
    <sub>Úroveň ověření: <strong>@Model.AuthLevel</strong> (@Model.Exp xp)</sub> <sub style="float:right">Získaná ocenění:</sub>
    <br />
    <div class="col-sm-12">
        @foreach (KnihovnaOceneni o in ViewBag.Oceneni as List<KnihovnaOceneni>)
        {
            <img src="@Url.Content("~/Uploads/Odznaky/" + o.Image)" class="animated" style="float:right" title="@o.Name" data-tippy-placement="bottom" onclick="openModelWindow()" id="loadPartialView" mydata="@o.Id" />
        }
        <br />
    </div>
    <br />
    <sub>Přidal se: @Model.JoinedDateTime</sub>

    @if (ViewBag.Owner)
    {
        <p>Jsi vlastník tohoto profilu!</p>
        <p>Uživatelské ID: @Model.Id</p>
        <p>Heslo: @Model.Password</p>
        <p>Úroveň oprávnění: @Model.Role.RoleDescription</p>

        <div>
            <p>Nálada: @Model.NeedJob</p>
            <button class="btn btn-default" onclick="openModelWindow()" id="loadPartialView2">[Upravit]</button>
        </div>


        <p>Nastav si text pro návštěvy:</p>
        <div class="row">
            @if (User.Identity.IsAuthenticated)
            {
                using (Html.BeginForm("EditProfile", "Profile", FormMethod.Post, new { @class = "col-md-12", enctype = "multipart/form-data" })) // Umožní zpracovat nahrané soubory
                {
                    <div class="form-group">
                        <div>
                            @Html.TextAreaFor(x => x.WelcomeText, new { @class = "form-control formatedtext" })
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-12">
                            <button type="submit" class="btn btn-default">Upravit text</button>
                        </div>
                    </div>
                }
            }
        </div>

        <script type="text/javascript">
            $(function () {
                $("#welcomeText").html("");
            });

          //  jQuery('#myModal').on('hidden.bs.modal', function () {
          //      location.reload();
          //  })
        </script>

        <style>
            .mce-path { /* CSS */
                display: none !important;
            }
        </style>
        <script src="@Url.Content("~/Scripts/tinymce/tinymce.js")"></script>
        <script>
            tinymce.init({
                selector: '.formatedtext', branding: false, plugins: 'code,emoticons,lists,advlist,autolink,autoresize,autosave,codesample,textcolor,colorpicker,fullscreen,hr,image,link,media,preview,searchreplace,table,textpattern,wordcount', toolbar: 'image,code,emoticons,bulllist,numlist,restoredraft,codesample,forecolor,backcolor,fullscreen,preview,searchreplace', width: '100%', language: 'cs'


            });</script>
    }
    else
    {
        <hr />
        <p>@Html.Raw(Model.WelcomeText)</p>
    }
</div>

<script type="text/javascript">
    function openModelWindow() {

        jQuery('#myModal').modal('toggle');
    }
</script>

<script>
    tippy('[title]')
</script>

<script type="text/javascript">
    jQuery("#loadPartialView").click(function () {

        var u = jQuery(this).attr('mydata');


        jQuery.get('@Url.Action("Test","Home")', {Id: u}, function (response) {
            jQuery("#modalContent").html(response);
        });
    });

    jQuery("#loadPartialView2").click(function () {

        jQuery.get('@Url.Action("NastavNaladu","Home")', {}, function (response) {
            jQuery("#modalContent").html(response);
        });
    });

    openModelWindow();
</script>