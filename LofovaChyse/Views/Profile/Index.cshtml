@using DataAccess.Models
@using LofovaChyse.Class
@model DataAccess.Models.KnihovnaUser
@{
    ViewBag.Title = "Index";
    ViewBag.Oceneni = General.GetUserOceneni(Model.Login);

    bool areFriends = true;
    bool canAdd = false;

    string friendMessage = "Přihlášení uživatelé si mohou přidat přátele";

    if (User.Identity.IsAuthenticated)
    {
        areFriends = General.UsersAreFrineds(User.Identity.Name, Model.Login);

        if (!areFriends)
        {
            if (Model.Login == User.Identity.Name)
            {
                friendMessage = "Nemůžeš mít sám sebe za přítele";
            }
            else
            {
                friendMessage = "Tohoto člověka si můžeš přidat za přítele";
                canAdd = true;
            }
        }
        else
        {
            bool friendsConfirmed = General.UsersAreFriendsConfirmed(User.Identity.Name, Model.Login);

            if (friendsConfirmed)
            {
                friendMessage = "S tímto člověkem již jsi kamarád";
            }
            else
            {
                friendMessage = "Žádost byla odeslána a čeká na vyřízení";
            }

        }
    }

    List<KnihovnaUserRole> tvojeRole = General.GetUserRoles(Model.Login);

}

<style>
    .nadpisProfil {
        display: inline-block;
    }

    .profilHorniPolozky {
        float: right;
        position: relative;
        color: darkgray;
    }

    .profilHorniPolozkyIkony {
        font-size: 2em;
        cursor: pointer;
    }

    .profilHorniPolozkyZamceno {
        opacity: 0.2;
    }

    .profilIkonaAktivni {
        opacity: 1;
        color: darkgray;
    }
</style>

<script>
    function onAdd() {
        jQuery('#friendRequest').remove();
        swal("Požadavek odeslán", "Dostaneš upozornění jakmile bude vyřízen", "success");
    }
</script>
<div id="ajaxContent">
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body" id="modalContent">
                </div>
            </div>
        </div>
    </div>

    @if (ViewBag.Owner)
    {
        <h2 class="nadpisProfil">Vítej na svém profilu</h2>
    }
    else
    {
        <h2>Profil uživatele @Model.Name</h2>
        <p>Jste přátelé? @friendMessage</p>

        if (canAdd)
        {
            <div id="friendRequest">
                @Ajax.ActionLink("Přidat přítele", "CallGeneral", "Home", new { user1 = User.Identity.Name, user2 = Model.Login }, new AjaxOptions() { }, new { onclick = "onAdd()" })
                <br />
            </div>
        }
    }
    
    <div id="polozkyProfilu" class="profilHorniPolozky">
        
        <div class="profilHorniPolozkyIkony" id="profilIkony">
            <a href="@Url.Action("Index")" title="Profil" data-tippy-placement="bottom"><i class="fas fa-address-card fa-fw profilIkonaAktivni"></i></a>
            <a title="Zeď" data-tippy-placement="bottom" onclick="akcePolozkyProfilu(1)"><i class="fas fa-comments fa-fw"></i></a>
            <a title="Galerie" data-tippy-placement="bottom" onclick="akcePolozkyProfilu(2)"><i class="fas fa-images fa-fw"></i></a>
            <a title="Snippet" data-tippy-placement="bottom" onclick="akcePolozkyProfilu(3)"><i class="fas fa-file-code fa-fw"></i></a>
            <a title="SoundUp" data-tippy-placement="bottom" onclick="akcePolozkyProfilu(4)"><i class="fas fa-music fa-fw"></i></a>
        </div>
    </div>
    
    <script>
        function akcePolozkyProfilu(index) {
            if (index !== 0) {
                if (@Model.AuthLevel == 0) {
                    swal({
                        title: "Nedostatečné ověření",
                        text: '@Html.Raw(Texty.ProfilSluzbyNedostatecneOvereni)',
                        type: 'warning',
                        html: true
                    });
                } else {
                    if (index == 1) {
                        window.location = '@Url.Action("ViewWall", new { id = Model.Id })';
                    }
                }
            }
        }
    </script>

    <p>Seznam tvých rolí:</p>
    <ul>
        @foreach (KnihovnaUserRole r in tvojeRole)
        {
            <li>
                @General.UserRoleName(r)
            </li>
        }
    </ul>

    <div id="moznostiKontaktu">
        <sub><a href="#">Poslat zprávu</a> | <a href="#">Další kontakty</a></sub>

    </div>

    <br />
    <br />
    <sub style="float: right"><strong>Profil</strong> | @Html.ActionLink("Zeď", "ViewWall", new { id = Model.Id }) | Galerie | Snippety</sub>
    <sub>Úroveň ověření: <strong>@Model.AuthLevel</strong> (@Model.Exp xp)</sub> <sub style="float: right">Získaná ocenění:</sub>
    <br />
    <div class="col-sm-12">
        @foreach (KnihovnaOceneni o in ViewBag.Oceneni as List<KnihovnaOceneni>)
        {
            <img src="@Url.Content("~/Uploads/Odznaky/" + o.Image)" class="animated" style="float: right" title="@o.Name" data-tippy-placement="bottom" onclick="openModelWindow()" id="loadPartialView" mydata="@o.Id" />
        }
        <br />
    </div>
    <br />
    <sub>Přidal se: @Model.JoinedDateTime</sub>
    @if (ViewBag.Owner)
    {
        <p>Jsi vlastník tohoto profilu!</p>
        <p>Uživatelské ID: @Model.Id</p>
        <p>Heslo: @Model.Password</p>
        <p>Úroveň oprávnění: @Model.Role.RoleDescription</p>
        <p>Zkušenosti: @Model.Exp</p>
        <p>Počet komentářů: @Model.CommentsNumber</p>
        <p>Reputace: @Model.LikesNumber</p>

        <div>
            <p id="ajaxNalada">Nálada: @Model.NeedJob</p>
            <button class="btn btn-default" onclick="openModelWindow()" id="loadPartialView2">[Upravit]</button>
        </div>


        <p>Nastav si text pro návštěvy:</p>
        <div class="row">
            @if (User.Identity.IsAuthenticated)
            {
                using (Html.BeginForm("EditProfile", "Profile", FormMethod.Post, new { @class = "col-md-12", enctype = "multipart/form-data" })) // Umožní zpracovat nahrané soubory
                {
                    <div class="form-group">
                        <div>
                            @Html.TextAreaFor(x => x.WelcomeText, new { @class = "form-control formatedtext" })
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-12">
                            <button type="submit" class="btn btn-default">Upravit text</button>
                        </div>
                    </div>
                }
            }
        </div>

        <script type="text/javascript">
            $(function () {
                $("#welcomeText").html("");
            });

            //  jQuery('#myModal').on('hidden.bs.modal', function () {
            //      location.reload();
            //  })
        </script>

        <style>

            .mce-path { /* CSS */
                display: none !important;
            }
        </style>
        <script src="@Url.Content("~/Scripts/tinymce/tinymce.js")"></script>
        <script>
            tinymce.init({
                selector: '.formatedtext',
                branding: false,
                plugins:
                    'code,emoticons,lists,advlist,autolink,autoresize,autosave,codesample,textcolor,colorpicker,fullscreen,hr,image,link,media,preview,searchreplace,table,textpattern,wordcount',
                toolbar:
                    'image,code,emoticons,bulllist,numlist,restoredraft,codesample,forecolor,backcolor,fullscreen,preview,searchreplace',
                width: '100%',
                language: 'cs'


            });
        </script>
    }
    else
    {
        <hr />
        <p>@Html.Raw(Model.WelcomeText)</p>
    }
</div>

<script type="text/javascript">
    function openModelWindow() {

        jQuery('#myModal').modal('toggle');
    }
</script>

<script>
    tippy('[title]')
</script>

<script type="text/javascript">
    jQuery("#loadPartialView").click(function() {

        var u = jQuery(this).attr('mydata');


        jQuery.get('@Url.Action("Test", "Home")',
            { Id: u },
            function(response) {
                jQuery("#modalContent").html(response);
            });
    });

    jQuery("#loadPartialView2").click(function() {

        jQuery.get('@Url.Action("NastavNaladu", "Home")',
            {},
            function(response) {
                jQuery("#modalContent").html(response);
            });
    });

    //openModelWindow();
</script>

@{
    if (Model.AuthLevel == 0)
    {
        <script>
            $(".profilHorniPolozkyIkony i").addClass("profilHorniPolozkyZamceno");
        </script>
    }
}